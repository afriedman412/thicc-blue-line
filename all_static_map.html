<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';">
  <title>Thin Blue Line American Flag (CSS)</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div id="main">
    <div class="upper-container" id="flag">
    <div class="flag">
        <!-- LAYER 1: Stripes -->
        <div class="stripe black-stripe remaining-stripe"></div>
        <div class="stripe white-stripe remaining-stripe"></div>
        <div class="stripe black-stripe remaining-stripe"></div>

        <!-- Blue Stripe (N% of flag height) -->
        <div class="stripe blue-stripe"></div>

        <!-- Remaining Stripes -->
        <div class="stripe black-stripe remaining-stripe"></div>
        <div class="stripe white-stripe remaining-stripe"></div>
        <div class="stripe black-stripe remaining-stripe"></div>

        <!-- LAYER 2: Black Union Box -->
        <div class="union">
        <!-- LAYER 3: Stars inside the Union -->
        <div class="union-stars">
            <!-- Row 1 (6 stars) -->
            <div class="row">
            <div class="star"></div><div class="star"></div><div class="star"></div><div class="star"></div><div class="star"></div><div class="star"></div>
            </div>
            <!-- Row 2 (5 stars) -->
            <div class="row">
            <div class="star"></div><div class="star"></div><div class="star"></div><div class="star"></div><div class="star"></div>
            </div>
            <!-- Row 3 (6 stars) -->
            <div class="row">
            <div class="star"></div><div class="star"></div><div class="star"></div><div class="star"></div><div class="star"></div><div class="star"></div>
            </div>
            <!-- Row 4 (5 stars) -->
            <div class="row">
            <div class="star"></div><div class="star"></div><div class="star"></div><div class="star"></div><div class="star"></div>
            </div>
            <!-- Row 5 (6 stars) -->
            <div class="row">
            <div class="star"></div><div class="star"></div><div class="star"></div><div class="star"></div><div class="star"></div><div class="star"></div>
            </div>
            <!-- Row 6 (5 stars) -->
            <div class="row">
            <div class="star"></div><div class="star"></div><div class="star"></div><div class="star"></div><div class="star"></div>
            </div>
            <!-- Row 7 (6 stars) -->
            <div class="row">
            <div class="star"></div><div class="star"></div><div class="star"></div><div class="star"></div><div class="star"></div><div class="star"></div>
            </div>
        </div>
        </div>
    </div>
    </div>
    <div class="upper-container" id="budget-info">XXXXXX</div>
</div>


</div>
    <!-- Text that displays the name of the selected city -->
    <div id="details-box"></div>
  
    <!-- Container to hold the SVG map -->
<div id="map-container">
      <?xml version="1.0" encoding="UTF-8" standalone="no"?>
  <!--
  ************* Copyright (c) 2017 Pareto Softare, LLC DBA Simplemaps.com *******************		
  ************* Free for Commercial Use, full terms at  http://simplemaps.com/resources/svg-license ************
  ************* Attribution is appreciated! http://simplemaps.com ***************************
  -->
  
  <object id="map" type="image/svg+xml" data="map.svg">Your browser does not support SVG</object>

  
    </div>
    <div id="tooltip"></div>
    <script nonce="randomValueGeneratedEachRequest">
   document.addEventListener("DOMContentLoaded", function() {
    const svgObject = document.getElementById('map');
    svgObject.addEventListener("load", function() {
        const svgDoc = svgObject.contentDocument;
        if (!svgDoc) {
            console.error('SVG has not loaded correctly or is inaccessible.');
            return;
        }

        const svgRoot = svgDoc.documentElement;
        const tooltip = document.getElementById('tooltip');
        const budgetInfoBox = document.getElementById('budget-info');
        const flagBox = document.getElementById('flag');

        const cities = svgRoot.querySelectorAll('.city');

        cities.forEach(city => {
            // city.addEventListener('mouseover', function(e) {
            //     tooltip.style.display = 'block';
            //     tooltip.style.left = (e.clientX + 10) + 'px';
            //     tooltip.style.top = (e.clientY + 10) + 'px';
            //     tooltip.textContent = city.getAttribute('name');  // Using getAttribute to access the 'name' attribute
            // });

            // city.addEventListener('mousemove', function(e) {
            //     tooltip.style.left = (e.clientX + 10) + 'px';
            //     tooltip.style.top = (e.clientY + 10) + 'px';
            // });

            // city.addEventListener('mouseout', function() {
            //     tooltip.style.display = 'none';
            // });

            city.addEventListener('click', function() {
                console.log("Circle clicked: ", city.getAttribute('name'));
                fetch('http://localhost:8000/budget_data.json')
                .then(response => {
                    if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                    return response.json();
                })
                .then(data => {
                    let cityData = data[city.id];
                    if (cityData) {
                        budgetInfoBox.innerHTML = `CITY NAME: ${cityData.name}<br>TOTAL BUDGET: $${cityData.totalBudget}<br>POLICE BUDGET: $${cityData.policeBudget}`;

                        if (flagBox) {
                            const policeBudgetPercentage = (cityData.policeBudget / cityData.totalBudget) * 100;
                            flagBox.style.setProperty('--blue-line-height', `${policeBudgetPercentage}%`);
                        }
                    } else {
                        console.error('No data found for:', city.getAttribute('name'));
                    }
                })
                .catch(error => console.error('Error fetching city budget data:', error));
            });
        });
    });
});
</script>
        
</body>
</html>
